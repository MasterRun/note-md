# Flutter

## 路由管理

### flutter路由

路由:网络路由、后端路由、前端路由等

- 核心是路由映射表
- genuine名字完成路由的转发，前端的表现就是页面跳转

flutter路由：Route、Navigator

### Route

Route：一个页面想被路由统一管理，必须包装为一个Route

Route是抽象类，使用MaterialPageRoute

MaterialPageRoute不是Route的直接子类：

- MaterialPageRoute在不同平台有不同的表现
- 在Android平台，打开页面会动屏幕底部滑动到屏幕顶部，关闭页面会从屏幕顶部滑动到底部消失
- 在iOS平台，打开页面会从屏幕右侧滑动到屏幕左侧，关闭页面会从屏幕左侧滑动到屏幕右侧
- iOS平台可使用CupertinoPageRoute

```txt
MaterialPageRoute -> PagaeRoute -> ModalRoute -> TransitionRoute -> OverlayRoute -> Route
```

### Navigator

Navigator：管理所有的Route的WIdget，通过Stack管理

- 官方说法： A Widget that manages  a set of child widgets with a stack discipline.
- MaterialApp、CupertinoApp、WidgetsApp是默认有插入Navigator的，可直接使用

```dart
Navigator.of(context)
```

常见用法

```dart
//路由跳转，传入一个路由对象
Future<T> push<T extends Object>(Route<T> route)

//路由跳转，传入一个名称（命名路由）
Future<T> pushNamed<T extends Object>(
    String routeName, {
        Object arguments,
    })

//路由返回，可以传入一个参数
bool pop<T extends Object>([T result ])
```

## 路由基本使用

### 基本跳转

- 创建首页页面，中间添加按钮，点击按钮跳转到详情页面
- 创建详情页面，中间添加按钮，点击按钮回到首页页面

```dart
//RaisedButton，点击打开详情页
RaisedButton(
    child: Text("打开详情页"),
    onPressed: () => _onPushTap(context).
),

//点击按钮跳转到详情页
_onPushTap(BuildContext context) {
    Navigator.of(context).push(MaterialPageRoute(
        builder: (context) {
            return DetailPage();
        }
    ));
}
```

```dart
//RaisedButton 点击返回首页
RaisedButton(
   child: Text("返回首页"),
   onPressed: () => _onNackTap(context),
),

//按钮点击返回首页
_onBackTap(BuildContext context) {
    Navigator.of(context).pop();
}
```

### 参数传递

- 跳转页面时，会返回一个Future
- 该Future会在详情页面调用pop是，回调对应的then函数，并且会携带结果

```dart
_onPushTap(BuildContext context) {
    //跳转代码
    final future = Navigator.of(context).push(MaterialPageRoute(
       builder: (context) {
           return DetailPage("a home message");
       } 
    ));


    future.then((res) {
        setState(() {
         _message = res;
        });
    })
}
```

```dart
_onBackTap(BuildContext context) {
    Navigator.of(context).pop("a detail message");
}
```

### 返回细节

返回按钮监听

方法一： 自定义返回按钮（在详情页中修改Scaffold的appBar）

```dart
appBar: Appbar(
    title: Text("详情页"),
    leading: IconButton(
        icon: Icon(Icons.arrow_back),
        onPressed: () {
            Navigator.of(context).pop(" a back detail message");
        },
    ),
),
```

方法二：监听返回按钮的点击（给Scaffold包裹一个WillPopScope)


